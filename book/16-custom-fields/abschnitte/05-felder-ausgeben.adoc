=== Felder ausgeben – so geht es!

Felder können auf verschiedene Arten ausgeben werden. Nachfolgend lernen
Sie kennen, wie man die Ausgabe der Felder in den verschiedenen
Joomla!-Komponenten genau steuern kann.

==== Automatische Anzeige

Die Option _Automatische Anzeige_, die im Kapitel 16.1.2.2 bereits
aufgezählt wurde, gibt das Feld an vorgegebenen Stellen in Verbindung
mit Trigger-Events aus.

Um das besser zu verstehen, öffnen Sie am besten den
Standard-Beitrags-View unter
_/components/com++_++content/views/article/tmpl/default.php_ und sehen
sich den Code an.

In der Originaldatei (Joomla! Version 3.7.0) finden Sie:

* In _Zeile 81_ den _AfterDisplayTitle_-Trigger (Nach Titel)

++<++?php echo $this-++>++item-++>++event-++>++afterDisplayTitle; ?++>++

* In _Zeile 94_ den _BeforeDisplayContent_-Trigger (Vor Inhalt)

++<++?php echo $this-++>++item-++>++event-++>++beforeDisplayContent;
?++>++

* In _Zeile 170_ den _AfterDisplayContent_-Trigger (Nach Inhalt)

++<++?php echo $this-++>++item-++>++event-++>++afterDisplayContent;
?++>++

Wenn Sie eine dieser Anzeigemöglichkeiten wählen, werden die Felder an
entsprechender Stelle mit dem Standard-Layout ausgegeben. Sie können
entweder einen dieser Vorschläge wählen oder die _Automatische Anzeige_
ausschalten.

[width="99%",cols="14%,86%",options="header",]
|===
|CHV++_++BOX++_++ID++_++02 |
|icn002 |*Hinweis:* Die Automatische Anzeige trifft nur bei Feldern in
Erweiterungen zu, die diese Plug-in bzw. Trigger-Events einbinden.
Aktuell sind das die Felder in Beiträgen, Kategorien, Kontakten und
Kontaktkategorien.
|===

==== Benutzerprofil

Die Felder werden im Frontend in einer Feldgruppe unter den bereits
bestehenden Benutzerfeldern im Profil ausgegeben. Dieses Profil ist
jeweils nur dem jeweiligen Benutzer selbst zugänglich. An dieser Stelle
gibt es von Haus aus keine Möglichkeit, die Ausgabe über die
_Automatische Anzeige_ zu kontrollieren. Die Einstellungen, die Sie hier
also vornehmen, haben keine Auswirkung.

Wenn nun aber keine automatische Anzeige möglich ist und uns die
Möglichkeit verwehrt bleibt, die Ausgabe der Felder zu steuern, wie
können wir nun ein individuelles Layout mit den eigenen Feldern
erstellen? Das kann über ein Override oder Alternatives Layout gelöst
werden.

===== Override/Alternatives Layout

Um die Ausgabe des Benutzerprofils zu individualisieren, müssen Sie wie
im Kapitel 12.1 beschrieben ein Override oder ein Alternatives Layout
von der Datei _/components/com++_++users/views/profile/tmpl/default.php_
anlegen.

Kurz in Ihre Erinnerung zurückgerufen, kopieren Sie dazu diese Datei und
die damit verknüpften Unterdateien in Ihren Template-Ordner unter
_/templates/ihrtemplate/html/com++_++users/profile/default.php_ und
verändern den Code nach Ihren Vorstellungen.

Einzelne Felder können Sie mit Hilfe der Feld-ID durch folgende Zeile
abrufen. Die Feld-ID ist die eindeutige Identifikation des Felds. Sie
finden diese in der Feldübersicht rechts in der Spalte „ID“.

++<++?php echo $this-++>++data-++>++jcfields++[++21++]++-++>++value;
?++>++

Des Weiteren finden Sie im _View_ des Benutzerprofils, in der Datei
_default++_++custom.php_ (siehe Listing 16.1), eine foreach-Schleife,
die es ermöglicht, Felder anhand ihres Namens folgendermaßen auszugeben:

++<++?php echo $customFields++[++'firmenfarbe'++]++-++>++value; ?++>++

Listing 16.1 – Ausschnitt aus der Datei
_/components/com++_++users/views/profile/tmpl/default++_++custom.php_ –
hier werden die Feld-Namen der Variable $customFields zugeordnet

$tmp = isset($this-++>++data-++>++jcfields) ?
$this-++>++data-++>++jcfields : array(); +
$customFields = array(); +
+
foreach ($tmp as $customField) +
++{++ +
$customFields++[++$customField-++>++name++]++ = $customField; +
}

==== Im Beitrag

Neben der Automatischen Anzeige aus Kapitel 16.1.5.1 können eigene
Felder auch über _Shortcodes_ im Editor eingebunden werden. Dazu finden
Sie im Joomla!-Core-Editor _tinyMCE_ einen Button. Klicken Sie, wie im
Bild 16.7 gezeigt, bei den Editor-Schaltflächen auf FELDER. Es öffnet
sich ein modales Fenster mit einer Feldübersicht, wie im Bild 16.8.
Sobald Sie ein Feld anklicken, setzt diese Schaltfläche einen
Plug-in-Code in Ihren Beitrag, der das Feld dann im Frontend an der
entsprechenden Stelle ausgibt. Zum Beispiel lädt _++{++field 1}_ das
Feld mit der _ID 1_.

image:media/image7.jpg[media/image7,width=548,height=281]

Bild 16.7 – Schaltfläche im _tinyMCE_-Editor

image:media/image8.jpg[media/image8,width=548,height=281]

Bild 16.8 – Fenster zur Auswahl von Modulen

[width="99%",cols="14%,86%",options="header",]
|===
|CHV++_++BOX++_++ID++_++02 |
|icn002 |*Hinweis:* Das Fenster dient Ihnen zur Hilfe, die richtigen
Felder zu finden. Es werden alle für diese Erweiterung verfügbaren
Felder angezeigt. Sie müssen selbst darauf achten, dass das Feld auch
diesem Beitrag, dieser Kategorie oder einem anderen Kontext zugeordnet
und befüllt sein muss, damit Sie mithilfe des Codes, den der Button
einsetzt, Inhalte darstellen können. Wollen Sie sichergehen, dass die
Felder ausgefüllt werden, dann konfigurieren Sie diese als
Pflichtfelder.
|===

Sie können auch eine ganze Feldgruppe über dieses Popup-Fenster
auswählen, indem Sie in der Spalte „Feldgruppe“ auf den orangefarbigen
Button klicken, der den Feldgruppennamen trägt. Daraufhin wird ein
Shortcode mit der Feldgruppen-ID eingebunden. Beispielsweise:
++{++fieldgroup 1}.

Für die Ausgabe über den Shortcode können Sie ein Alternatives Layout
anlegen. Kopieren Sie dazu die Datei:
/components/com++_++field/layouts/field/render.php in Ihr Template unter
/templates/*ihrtemplate*/html/layouts/com++_++fields/field/*layoutname.php*

Um das Feld mit dem alternativen Layout im Inhalt aufzurufen, schreiben
Sie den Dateinamen hinter die Feldid. Zum Beispiel: ++{++field 1,
layoutname}

======= Ausgabe der Felder in einem Override/Alternativen Layout

Sie können eigene Felder auch in einem Override oder Alternativen Layout
vom Beitragslayout, siehe Kapitel 12.1.3, ausgeben. Notieren Sie sich zu
jedem Feld die dazugehörige ID oder den Feldnamen. Der Feldwert kann
dann in Ihrem Override über folgenden Code eingebunden werden. Beachten
Sie dabei die Zahl in den eckigen Klammern, die der Feld-ID entsprechen
muss.

++<++?php echo $this-++>++item-++>++jcfields++[++3++]++-++>++value;
?++>++

Neben dem Feldwert (_value_) können Sie auch die Beschriftung (_label_)
und weitere Feldparameter in Ihrem Override oder Alternativen Layout
abrufen.

[width="99%",cols="14%,86%",options="header",]
|===
|CHV++_++BOX++_++ID++_++01 |
|icn001 a|
*Praxistipp:* Wenn es Ihnen zu mühsam ist, sich die IDs der Felder zu
merken, können Sie über PHP zunächst die Feldnamen abrufen und zuordnen.
Anschließend können Sie dann den Namen nutzen, um die Felder auszugeben.
Dazu tragen Sie diesen Code vor dem Feldabruf in Ihre Datei ein:

// Beitrags-Felder Mapping +
$customFields = $this-++>++item-++>++jcfields; +
foreach ($customFields as $customField)++{++ +
$customFields++[++$customField-++>++name++]++ = $customField; +
}

Anschließend können Sie den Feldwert mit folgender Zeile aufrufen:

echo $customFields++[++'feldname'++]++-++>++value;

Sie können sich dadurch alle zur Verfügung stehenden Werte und Parameter
eines Felds während der Entwicklung über folgenden Code ausgeben lassen.

++<++pre++><++?php print++_++r($customFields++[++'feldname'++]++);
?++><++/pre++>++

|===

===== Benutzer-Felder im Beitrag wiedergeben

Grundsätzlich ist es auch möglich, dem Benutzer zugeordnete Felder im
Beitrag anzuzeigen. So können Sie als Abspann in einem Beitrag zum
Beispiel Informationen zum Autor darstellen. Dazu müssen Sie aber
zunächst sicherstellen, dass Ihr Layout über den im Listing 16.2
angezeigten Code Zugriff auf das Userobjekt, den Beitragsautor und die
dazugehörigen Felder hat.

Listing 16.2 – Abrufen des Benutzers im Beitragslayout

$user = JFactory::getUser($this-++>++item-++>++created++_++by); +
JEventDispatcher::getInstance()-++>++trigger('onContentPrepare',
array( +
'com++_++users.user',&$user,&$user-++>++params,0 ));

Anschließend können Sie über folgende Zeile Ihren Feldwert ausgeben.
Beachten Sie erneut, dass die Zahl in eckigen Klammern der _ID_ des
Felds im _Benutzer-Manager_ entsprechen muss.

++<++?php echo $user-++>++jcfields++[++3++]++-++>++value; ?++>++

[width="99%",cols="14%,86%",options="header",]
|===
|CHV++_++BOX++_++ID++_++01 |
|icn001 a|
*Praxistipp:* Wie auch bei den Beitragsfeldern, können Sie beim Benutzer
die Felder mithilfe des Feldnamens ausgeben.

//Benutzer-Felder Mapping +
$userFields = $user-++>++jcfields; +
foreach ($userFields as $userField)++{++ +
$userFields++[++$userField-++>++name++]++ = $userField; +
}

Anschließend können Sie den Feldwert mit folgender Zeile aufrufen:

echo $userFields++[++'firmenfarbe'++]++-++>++value;

Sie können sich dann auch alle zur Verfügung stehenden Werte und
Parameter eines Felds während der Entwicklung über folgenden Code
ausgeben lassen.

++<++pre++><++?php print++_++r($userFields++[++'firmenfarbe'++]++);
?++><++/pre++>++

|===

==== Im Kontakt

Für die Ausgabe der Kontaktinformationen können Sie im Kontakt die
Parameter aus der Automatischen Anzeige aus Kapitel 16.1.4.1 verwenden,
um die Ausgabe der Felder zu steuern oder unter Komponenten » Kontakt »
Kontakt Bearbeiten im Reiter Weitere Informationen den Editor-Button
(16.1.4.3) nutzen, um Felder an entsprechender Stelle auszugeben – so
wie Sie es auch aus dem Beitrag kennen.

Für ein Override der Kontaktanzeige notieren Sie sich zu jedem Feld die
dazugehörige ID. Sie können den Feldwert dann in Ihrem Override über
folgenden Code einbinden, beachten Sie dabei die Zahl in den eckigen
Klammern, die der Feld-ID entsprechen muss.

++<++?php echo $this-++>++item-++>++jcfields++[++18++]++-++>++value;
?++>++

[width="99%",cols="14%,86%",options="header",]
|===
|CHV++_++BOX++_++ID++_++01 |
|icn001 a|
*Praxistipp:* Auch hier können Sie Kontaktinformationen der Felder
mithilfe des Feldnamens ausgeben.

//Kontaktfelder Mapping +
$contactFields = $this-++>++item-++>++jcfields; +
foreach ($contactFields as $contactField) +
++{++ +
$contactFields++[++$contactField-++>++name++]++ = $contactField; +
}

Anschließend können Sie dann den Feldwert mit folgender Zeile aufrufen:

echo $contactFields++[++_'kontaktinfo'_++]++-++>++value;

|===

===== Benutzerfelder im Kontakt wiedergeben

Wenn der Kontakt mit dem Nutzer verbunden ist, gibt es zwei
Möglichkeiten, die Daten aus dem Benutzerprofil innerhalb der
Kontaktinformationen einzublenden:

Wenn Sie den Kontakt-Menüpunkt bearbeiten, finden Sie im Reiter
Kontaktanzeigeoptionen die Einstellung _Eigene Felder anzeigen_. Die
gleiche Einstellung ist im Kontakt selbst im Reiter „Anzeige“ und in den
globalen Optionen der Kontakt-Komponente zu finden.

image:media/image9.jpg[media/image9,width=548,height=250]

Bild 16.9 – Einstellung der Anzeige von Benutzer-Feldern im Kontakt

Außerdem ist es möglich, die Benutzerfelder in Ihrem eigenen
Kontakt-Override/Layout über folgende Zeile auszugeben:

++<++?php echo
$this-++>++contactUser-++>++jcfields++[++20++]++-++>++value; ?++>++

Beachten Sie dabei, die Anzeige der Benutzer-Felder in den Optionen zu
aktivieren, und passen Sie das Layout von
/components/com++_++contact/views/contact/tmpl/default++_++user++_++custom++_++fields.php
mit Hilfe eines Overrides oder Alternativen Layouts in Ihrem Template
an.

==== Im Kontaktformular

Das Joomla!-Kontaktformular verfügt bereits über die Felder _Name_,
_Email_, _Betreff_, _Nachricht_, _E-Mail-Kopie_ und optional _Captcha_.
Wenn Sie eigene Felder hinzufügen, werden diese standardmäßig in einer
eigenen Feldgruppe mit dem Titel _Felder_ dargestellt. Sind die Felder
einer Feldgruppe zugeordnet, wird der Feldgruppen-Name als Überschrift
über den Feldern dargestellt. Die Einstellungen für die „Automatische
Anzeige“ haben im Kontaktformular keinen Einfluss auf die Position der
Felder.

===== Felder individuell per Override ausgeben

Wenn Sie die Reihenfolge aller Felder im Kontaktformular individuell
bestimmen wollen, dann müssen Sie ein Override der Datei
_components/com++_++contact/views/contact/tmpl/default++_++form.php_
anlegen.

Sehen wir uns die Datei _default++_++form.php_ im Listing 16.3 an. In
dem Formular befindet sich in den Zeilen 18–33 eine foreach-Schleife,
die innerhalb des form-Tags alle Felder abruft. Wenn wir nun die
foreach-Schleife löschen, werden natürlich auch die Core-Felder nicht
mehr ausgegeben.

Doch wie ruft man die Felder einzeln im Layout ab?

Dazu kann man sowohl die _renderField_-Methode, als auch die
_getField_-Methode anwenden.

Der Unterschied zwischen diesen Methoden besteht darin, dass
_renderField_ das komplette Feld inkl. Label ausgibt, so wie es im
_Layout_ für die Formfelder festgelegt ist. Die Methode _getField_ ist
hingegen imstande, das Label und das Formularfeld selbst unabhängig
voneinander auszugeben.

Listing 16.3 – Anzeige der Datei
_components/com++_++contact/views/contact/tmpl/default++_++form.php_

[arabic]
. ++<++?php
. /++**++
. ++*++ @package Joomla.Site
. ++*++ @subpackage com++_++contact
. ++*++
. ++*++ @copyright Copyright (C) 2005 - 2017 Open Source Matters, Inc.
All rights
. reserved.
. ++*++ @license GNU General Public License version 2 or later; see
LICENSE.txt
. ++*++/
. defined('++_++JEXEC') or die;
. {blank}
. JHtml::++_++('behavior.keepalive');
. JHtml::++_++('behavior.formvalidator');
. {blank}
. ?++>++
. ++<++div class="contact-form"++>++
. ++<++form id="contact-form" action="++<++?php echo
JRoute::++_++('index.php'); ?++>++" method="post" class="form-validate
form-horizontal well"++>++
. ++<++?php foreach ($this-++>++form-++>++getFieldsets() as $fieldset) :
?++>++
. ++<++?php if ($fieldset-++>++name === 'captcha'&&
!$this-++>++captchaEnabled) : ?++>++
. ++<++?php continue; ?++>++
. ++<++?php endif; ?++>++
. ++<++?php $fields =
$this-++>++form-++>++getFieldset($fieldset-++>++name); ?++>++
. ++<++?php if (count($fields)) : ?++>++
. ++<++fieldset++>++
. ++<++?php if (isset($fieldset-++>++label) && ($legend =
trim(JText::++_++($fieldset-++>++label))) !== '') : ?++>++
. ++<++legend++><++?php echo $legend; ?++><++/legend++>++
. ++<++?php endif; ?++>++
. ++<++?php foreach ($fields as $field) : ?++>++
. ++<++?php echo $field-++>++renderField(); ?++>++
. ++<++?php endforeach; ?++>++
. ++<++/fieldset++>++
. ++<++?php endif; ?++>++
. ++<++?php endforeach; ?++>++
. ++<++div class="control-group"++>++
. ++<++div class="controls"++>++
. ++<++button class="btn btn-primary validate" type="submit"++><++?php
echo JText::++_++('COM++_++CONTACT++_++CONTACT++_++SEND');
?++><++/button++>++
. ++<++input type="hidden" name="option" value="com++_++contact" /++>++
. ++<++input type="hidden" name="task" value="contact.submit" /++>++
. ++<++input type="hidden" name="return" value="++<++?php echo
$this-++>++return++_++page; ?++>++" /++>++
. ++<++input type="hidden" name="id" value="++<++?php echo
$this-++>++contact-++>++slug; ?++>++" /++>++
. ++<++?php echo JHtml::++_++('form.token'); ?++>++
. ++<++/div++>++
. ++<++/div++>++
. ++<++/form++>++
. ++<++/div++>++

Eine Übersicht, wie Sie die Kontaktfelder mit der _renderField_-Methode
aufrufen, können Sie der Tabelle 16.1 entnehmen. Der Einsatz von
_renderField_ übernimmt alle Feldeinstellungen aus dem Backend (z.B. die
Feldbeschriftung nicht anzuzeigen).

Tabelle 16.1 – Aufruf der Felder über die
_renderField_[.indexref]##-Methode

[width="100%",cols="63%,37%",options="header",]
|===
|++<++?php echo $this-++>++form-++>++renderField('contact++_++name');
?++>++ |Absendername
|++<++?php echo $this-++>++form-++>++renderField('contact++_++email');
?++>++ |E-Mail des Absenders

|++<++?php echo $this-++>++form-++>++renderField('contact++_++subject',
null); ?++>++ |E-Mail-Betreff

|++<++?php echo $this-++>++form-++>++renderField('contact++_++message',
null); ?++>++ |Nachricht

|++<++?php echo
$this-++>++form-++>++renderField('contact++_++email++_++copy', null);
?++>++ |Kopie an den Absender senden

|++<++?php echo $this-++>++form-++>++renderField('captcha', null);
?++>++ |Captcha Feld (beim aktivierten und konfigurierten Plug-in)

|++<++?php echo $this-++>++form-++>++renderField('*feldname*',
'com++_++fields'); ?++>++ |Ausgabe Ihres Eigenen Felds
|===

Wenn Sie komplett individuell auf die Felder zugreifen möchten, um somit
zum Beispiel das HTML-Layout der Ausgabe punktgenau zu definieren, dann
können Sie sich der _getField_-Methode bedienen. Eine weitere
Besonderheit ist es, dass man mithilfe von _getField_ im Layout eigene
Attribute setzen kann:

$field = $this-++>++form-++>++getField('feldname', 'com++_++fields'); +
$field-++>++class = 'ihreindividuelle++_++klasse'; +
echo $field-++>++renderField();

Tabelle 16.2 – Aufruf der Felder über die
_getField_[.indexref]##-Methode

[width="100%",cols="63%,37%",options="header",]
|===
a|
++<++?php +
$contactName = $this-++>++form-++>++getField('contact++_++name');

echo $contactName-++>++label; +
echo $contactName-++>++input; +
?++>++

|Absendername
|++<++?php +
$contactEmail = $this-++>++form-++>++getField('contact++_++email'); +
+
echo $contactEmail-++>++label; +
echo $contactEmail-++>++input; +
+
?++>++ |E-Mail des Absenders

|++<++?php +
$contactSubject =
$this-++>++form-++>++getField('contact++_++subject'); +
+
echo $contactSubject-++>++label; +
echo $contactSubject-++>++input; +
+
?++>++ |E-Mail-Betreff

a|
++<++?php +
$contactMessage = $this-++>++form-++>++getField('contact++_++message');

echo $contactMessage-++>++label; +
echo $contactMessage-++>++input; +
+
?++>++

|Nachricht

a|
++<++?php +
$contactEmailCopy =
$this-++>++form-++>++getField('contact++_++email++_++copy');

echo $contactEmailCopy-++>++label; +
echo $contactEmailCopy-++>++input; +
+
?++>++

|Kopie an den Absender senden

a|
++<++?php +
$fieldName = $this-++>++form-++>++getField('*feldname*',
'com++_++fields');

echo $fieldName-++>++label; +
echo $fieldName-++>++input; +
+
?++>++

|Ausgabe Ihres Eigenen Felds
|===

==== Override der Feldausgabe

Alle hinterlegten Feldwerte werden im Inhalt mit dem ++<++dd++>++-Tag in
einer Definitionsliste ++<++dl++>++ dargestellt. Wenn Sie dieses Markup
verändern und an Ihre Wünsche anpassen wollen, können Sie dies mit einem
Override in Ihrem Template überschreiben oder als alternatives Layout
anlegen.

===== Für Beiträge und Kategorien:

Für die Definitionsliste, die um alle Felder herum dargestellt wird,
kopieren Sie die Datei
_components/com++_++fields/layouts/fields/render.php_ in Ihren
Templateordner unter
_templates/ihrtemplate/html/layouts/com++_++fields/fields/render.php_.
Sie können die Datei nach Ihren Wünschen anpassen.

Für das Markup, welches um die einzelnen Felder herum dargestellt wird,
kopieren Sie die Datei
_components/com++_++fields/layouts/field/render.php_ in Ihren
Templateordner unter
_templates/ihrtemplate/html/layouts/com++_++fields/field/render.php_ und
passen das Markup entsprechend an.

===== Für Kontakte:

Für die Definitionsliste, die um alle Felder herum dargestellt wird,
kopieren Sie die Datei
_components/com++_++contact/layouts/fields/render.php_ in Ihren
Templateordner unter
_templates/ihrtemplate/html/layouts/com++_++contact/fields/render.php_.
Sie können die Datei nach Ihren Wünschen anpassen.

Für das Markup, welches um die einzelnen Felder herum dargestellt wird,
kopieren Sie die Datei
_components/com++_++contact/layouts/field/render.php_ in Ihren
Templateordner unter
_templates/ihrtemplate/html/layouts/com++_++contact/field/render.php_
und passen das Markup entsprechend an.

===== In anderen Bereichen:

Die Ausgaben für die Benutzer-Felder im Kontakt und Benutzer-Felder im
Profil werden direkt im jeweiligen Layout der Komponente beeinflusst.
